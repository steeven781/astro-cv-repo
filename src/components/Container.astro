---
import { getCollection } from "astro:content";
import { Icon } from "astro-icon/components";
import AccordionLayout from "../layouts/AccordionLayout.astro";
import Card from "./Card.astro";
import CardCarrousel from "./CardCarrousel.astro";
import ContactCard from "./ContactCard.astro";
import ScrollObserver from "./ScrollObserver.astro";
import CardGrid from "./CardGrid.astro";

const works = await getCollection("work");
const projects = await getCollection("projects");
const studies = await getCollection("studies");
const certificates = await getCollection("certificates");
const customers = await getCollection("customers");
const contact = await getCollection("contact");
const about = await getCollection("about");
const { Content: AboutContent } = await about[0].render();
const PDF = "/cv-2025.pdf";
---

<div class="join join-vertical gap-1">
  <ScrollObserver>
    <AccordionLayout title={"About"} icon={"carbon:identification"}>
      <div class="flex flex-col md:flex-row items-center md:items-start gap-6 md:gap-8">
        <div class="flex flex-col items-center text-center md:w-1/3 md:items-start md:text-left">
          <div class="w-32 h-32 md:w-36 md:h-36 flex-shrink-0 rounded-full overflow-hidden shadow-lg border-2 border-base-300">
            <img src="/profile.webp" alt="Profile Picture" class="w-full h-full object-cover" />
          </div>
          <h2 class="text-2xl font-bold mt-4">{about[0].data.name}</h2>
          <p class="text-secondary">{about[0].data.designation}</p>
          <div class="flex justify-center md:justify-start gap-4 mt-4">
            {contact.filter(c => c.data.title !== 'WhatsApp').map(c => (
              <a href={c.data.url} target="_blank" rel="noopener noreferrer" class="text-secondary hover:text-primary">
                <Icon name={c.data.icon} class="w-6 h-6" />
              </a>
            ))}
          </div>
        </div>
        <div class="md:w-2/3 mt-4 md:mt-0 prose text-secondary/90 max-w-none text-justify">
          <AboutContent />
        </div>
      </div>
    </AccordionLayout>
  </ScrollObserver>

  <ScrollObserver>
    <AccordionLayout title={"Work"} icon={"carbon:construction"}>
      <CardGrid collection={works} cardType="timeline" />
    </AccordionLayout>
  </ScrollObserver>

  <ScrollObserver>
    <AccordionLayout title={"Studies"} icon={"carbon:education"}>
      <CardGrid collection={studies} />
    </AccordionLayout>
  </ScrollObserver>

  <ScrollObserver>
    <AccordionLayout title={"Projects"} icon={"carbon:tools"}>
      <CardGrid collection={projects} />
    </AccordionLayout>
  </ScrollObserver>

  <ScrollObserver>
    <AccordionLayout
      title={"Certifications & Courses"}
      icon={"carbon:certificate"}
    >
      <CardGrid collection={certificates} />
    </AccordionLayout>
  </ScrollObserver>

  <ScrollObserver>
    <AccordionLayout title={"Satisfied Customers"} icon={"carbon:user-admin"}>
      {
        customers.map((item) => {
          return (
            <CardCarrousel
              title={item.data.title}
              logos={item.data.logos}
            />
          );
        })
      }
    </AccordionLayout>
  </ScrollObserver>

  <ScrollObserver>
    <AccordionLayout title={"Files"} icon={"carbon:volume-file-storage"}>
      <div class="flex justify-center w-full">
        <div
          class="card card-compact card-bordered border-[oklch(var(--s))] w-96 md:w-112 lg:w-128 hover:shadow-lg transition-all"
        >
          <figure>
            <object data={PDF} type="application/pdf" width="100%"></object>
          </figure>
          <div class="card-body">
            <h2 class="card-title">Resume</h2>
            <p>View and download my resume by clicking on the button below</p>
            <div class="card-actions justify-end">
              <a target="_blank" href={PDF}>
                <button class="btn btn-outline">
                  <p>Download resume</p>
                  <Icon name="carbon:document-pdf" class="w-6 h-6 ml-1" />
                </button>
              </a>
            </div>
          </div>
        </div>
      </div>
    </AccordionLayout>
  </ScrollObserver>

  <ScrollObserver>
    <AccordionLayout title={"Contact"} icon={"carbon:location-person"}>
      <div class="flex flex-wrap content-around gap-4 justify-center">
      {
        contact.filter(c => c.data.title !== 'WhatsApp').map((item) => {
          return (
            <ContactCard
              url={item.data.url}
              url_name={item.data.title}
              icon={item.data.icon}
            />
          );
        })
      }
    </div>
    </AccordionLayout>
  </ScrollObserver>
</div>
